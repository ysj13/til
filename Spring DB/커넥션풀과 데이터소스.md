## Connection Pool

![화면 캡처 2023-06-19 004517](https://github.com/ysj13/til/assets/59955248/3d189b49-5f03-41ba-ab4a-0483a7e901a1)

DB 커넥션을 얻기 위해서는 매번 복잡한 과정을 거쳐야 한다.
DB뿐만 아니라 애플리케이션 서버에서도 매번 TCP/IP 커넥션을 새로 생성하기 위한 리소스를 사용해야 한다.

가장 큰 문제는 사용자(고객)가 애플리케이션을 사용할 때, 어떤 화면을 조회한다고 가정하면
데이터 조회를 위한 sql을 실행하는 시간 뿐만 아니라 매번 커넥션을 새로 만드는 시간도 추가된다.
따라서 페이지 로딩시간이 길어지고 결과적으로 응답속도가 늦어진다.

이러한 문제를 해결하기 위해 나온 방법은 커넥션을 미리 생성해두고 필요할때마다 이를 꺼내서 사용할 수 있도록 하는
커넥션 풀이라는 방법이다.

![화면 캡처 2023-06-19 004600](https://github.com/ysj13/til/assets/59955248/df68e04b-77ce-4a25-ac83-22d392d56592)

#### 1. 커넥션 풀 사용 - 1

애플리케이션을 시작하는 시점에 미리 커넥션 풀에 필요한만큼의 커넥션을 생성하여 보관해둔다.
커넥션풀에 보관되어 있는 커넥션은 TCP/IP 로 DB와 커넥션이 연결되어있는 상태이기 때문에
즉시 SQL을 DB로 전달할 수 있다.

커넥션 풀을 사용하면, 애플리케이션 로직에서 DB 드라이버를 통해 매번 새로운 커넥션을 얻는것이 아니라
커넥션풀에서 미리 생성되어있는 커넥션을 가져다 쓰기만 하면 된다.

#### 2. 커넥션 풀 사용 - 2

애플리케이션 로직은 커넥션 풀에서 받은 커넥션을 사용하여 SQL을 DB에 전달하고 그 결과를 받아서 처리한다.
커넥션을 모두 사용한 후 커넥션을 종료하는것이 아니라 다음에 다시 사용할 수 있도록
커넥션이 살아있는 상태로 커넥션풀에 해당 커넥션을 반환하면 된다.

대표적인 커넥션 풀 오픈소스는 commons-dbcp2 , tomcat-jdbc pool , HikariCP 등이 있다.
SpringBoot 2.0 부터는 기본 커넥션풀로 HikariCP를 제공한다.


## DataSource

커넥션을 얻는 방법은 JDBC DriverManager를 직접 사용하거나, 커넥션 풀을 사용하는 방법 등 여러가지 방법이 존재한다.

DriverManager를 통해 커넥션을 획득하다가 커넥션풀을 사용하도록 변경하려면, 기존 애플리케이션 로직을 수정해야 한다.
이를 해결하기 위해 javax.sql.DataSource 라는 인터페이스를 통해 커넥션을 획득하는 방법을 사용한다.

![화면 캡처 2023-06-19 004646](https://github.com/ysj13/til/assets/59955248/d9f88112-a3bb-4ef5-a746-a11e84f7142d)

DataSource는 커넥션을 획득하는 방법을 추상화하는 인터페이스이다.
대부분의 커넥션 풀은 DataSource 인터페이스를 이미 구현해두었기 떄문에, 개발자는 DBCP2 커넥션 풀, HikariCP 커넥션 풀 의 코드를 
직접 의존하는 것이 아니라 DataSource 인터페이스에만 의존하도록 애플리케이션 로직을 작성하면 된다.

![화면 캡처 2023-06-19 004707](https://github.com/ysj13/til/assets/59955248/18f78490-ad19-44e3-9d1e-e1cbd52ad014)


***
출처 : 스프링 DB 1편 - 데이터 접근 핵심 원리
https://www.inflearn.com/course/%EC%8A%A4%ED%94%84%EB%A7%81-db-1
